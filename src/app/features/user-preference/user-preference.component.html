<ion-header class="uniform-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button menu="main-menu"></ion-menu-button>
    </ion-buttons>
    <ion-title>{{ 'userPreferences.title' | translate }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="savePreferences()" [disabled]="!preferenceForm.valid || isLoading" fill="solid" color="primary">
        <ion-icon name="checkmark" slot="start"></ion-icon>
        {{ 'common.save' | translate }}
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="modern-form-content">
  <div class="form-container">
    <form [formGroup]="preferenceForm" (ngSubmit)="savePreferences()">
      
      <!-- Header Section -->
      <div class="form-header">
        <ion-icon name="settings" class="header-icon"></ion-icon>
        <h2>{{ 'userPreferences.title' | translate }}</h2>
        <p>{{ 'userPreferences.subtitle' | translate }}</p>
      </div>

      <!-- Form Fields -->
      <div class="form-fields">
        
        <!-- Language Selection -->
        <div class="field-group">
          <label class="field-label">{{ 'userPreferences.language' | translate }} *</label>
          <ion-select 
            formControlName="languageId" 
            [placeholder]="'userPreferences.selectLanguage' | translate"
            class="modern-select" 
            fill="outline">
            @for (lang of languages; track lang.id) {
              <ion-select-option [value]="lang.id">
                {{ lang.name }}
              </ion-select-option>
            }
          </ion-select>
          @if (preferenceForm.get('languageId')?.invalid && preferenceForm.get('languageId')?.touched) {
            <div class="error-message">
              {{ 'userPreferences.errors.languageRequired' | translate }}
            </div>
          }
        </div>

        <!-- Country Selection -->
        <div class="field-group">
          <label class="field-label">{{ 'userPreferences.country' | translate }} *</label>
          <ion-select 
            formControlName="countryId" 
            [placeholder]="'userPreferences.selectCountry' | translate"
            class="modern-select" 
            fill="outline">
            @for (country of countries; track country.id) {
              <ion-select-option [value]="country.id">
                {{ country.name }}
              </ion-select-option>
            }
          </ion-select>
          @if (preferenceForm.get('countryId')?.invalid && preferenceForm.get('countryId')?.touched) {
            <div class="error-message">
              {{ 'userPreferences.errors.countryRequired' | translate }}
            </div>
          }
        </div>

        <!-- Currency Selection -->
        <div class="field-group">
          <label class="field-label">{{ 'userPreferences.currency' | translate }} *</label>
          <ion-select 
            formControlName="currencyId" 
            [placeholder]="'userPreferences.selectCurrency' | translate"
            class="modern-select" 
            fill="outline">
            @for (currency of currencies; track currency.id) {
              <ion-select-option [value]="currency.id">
                {{ currency.name }} ({{ currency.code }})
              </ion-select-option>
            }
          </ion-select>
          @if (preferenceForm.get('currencyId')?.invalid && preferenceForm.get('currencyId')?.touched) {
            <div class="error-message">
              {{ 'userPreferences.errors.currencyRequired' | translate }}
            </div>
          }
        </div>

      </div>

      <!-- Loading Overlay -->
      @if (isLoading) {
        <div class="loading-overlay">
          <div class="loading-content">
            <ion-spinner name="crescent"></ion-spinner>
            <p>{{ 'userPreferences.saving' | translate }}...</p>
          </div>
        </div>
      }

    </form>
  </div>

  <!-- Footer with Action Buttons -->
  <ion-footer class="form-footer">
    <ion-toolbar>
      <div class="footer-buttons">
        <!-- Cancel Button -->
        <ion-button 
          (click)="cancelForm()" 
          fill="solid" 
          color="medium" 
          class="footer-btn cancel-btn">
          <ion-icon name="close" slot="icon-only"></ion-icon>
        </ion-button>

        <!-- Save Button -->
        <ion-button 
          (click)="savePreferences()" 
          [disabled]="!preferenceForm.valid || isLoading"
          fill="solid" 
          color="primary" 
          class="footer-btn save-btn">
          <ion-icon name="checkmark" slot="icon-only"></ion-icon>
        </ion-button>

        <!-- Exit Button -->
        <ion-button 
          (click)="exitScreen()" 
          fill="solid" 
          color="danger" 
          class="footer-btn exit-btn">
          <ion-icon name="home" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
    </ion-toolbar>
  </ion-footer>
</ion-content>
