<ion-header class="uniform-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button menu="main-menu"></ion-menu-button>
      <ion-back-button defaultHref="/vehicles"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'vehicles.editVehicle' | translate }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="saveVehicle()" [disabled]="!form.valid || loading" fill="solid" color="primary">
        <ion-icon name="checkmark" slot="start"></ion-icon>
        {{ 'common.save' | translate }}
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="modern-form-content">
  <div class="form-container">
    <form [formGroup]="form" (ngSubmit)="saveVehicle()">
      
      <!-- Header Section -->
      <div class="form-header">
        <ion-icon name="car" class="header-icon"></ion-icon>
        <h2>{{ 'vehicles.form.name' | translate }}</h2>
        <p>{{ 'vehicles.addVehicle' | translate }}</p>
      </div>

      <!-- Form Fields -->
      <div class="form-fields">
        
        <!-- Name Field -->
        <div class="field-group">
          <label class="field-label">{{ 'vehicles.form.name' | translate }} *</label>
          <ion-input 
            formControlName="name" 
            [placeholder]="'vehicles.form.enterName' | translate"
            class="modern-input"
            fill="outline">
          </ion-input>
          @if (form.get('name')?.invalid && form.get('name')?.touched) {
            <div class="error-message">
              {{ getFieldError('name') }}
            </div>
          }
        </div>

        <!-- Plate Number Field -->
        <div class="field-group">
          <label class="field-label">{{ 'vehicles.form.plateNumber' | translate }} *</label>
          <ion-input 
            formControlName="plateNumber" 
            [placeholder]="'vehicles.form.enterPlate' | translate"
            class="modern-input"
            fill="outline">
          </ion-input>
          @if (form.get('plateNumber')?.invalid && form.get('plateNumber')?.touched) {
            <div class="error-message">
              {{ getFieldError('plateNumber') }}
            </div>
          }
        </div>

        <!-- Brand Field -->
        <div class="field-group">
          <label class="field-label">{{ 'vehicles.form.brand' | translate }} *</label>
          <ion-select 
            formControlName="brandCode" 
            [placeholder]="'vehicles.form.selectBrand' | translate" 
            class="modern-select"
            fill="outline">
            @for (brand of brands; track brand.id) {
              <ion-select-option [value]="brand.id">
                {{ brand.name }}
              </ion-select-option>
            }
          </ion-select>
          @if (form.get('brandCode')?.invalid && form.get('brandCode')?.touched) {
            <div class="error-message">
              {{ getFieldError('brandCode') }}
            </div>
          }
        </div>

        <!-- Vehicle Type Field -->
        <div class="field-group">
          <label class="field-label">{{ 'vehicles.form.vehicleType' | translate }} *</label>
          <ion-select 
            formControlName="vehicleTypeId" 
            [placeholder]="'vehicles.form.selectVehicleType' | translate" 
            class="modern-select"
            fill="outline">
            @for (vehicleType of vehicleTypes; track vehicleType.id) {
              <ion-select-option [value]="vehicleType.id">
                {{ vehicleType.name }}
              </ion-select-option>
            }
          </ion-select>
          @if (form.get('vehicleTypeId')?.invalid && form.get('vehicleTypeId')?.touched) {
            <div class="error-message">
              {{ getFieldError('vehicleTypeId') }}
            </div>
          }
        </div>

        <!-- Model Field -->
        <div class="field-group">
          <label class="field-label">{{ 'vehicles.form.model' | translate }}</label>
          <ion-input 
            formControlName="model" 
            [placeholder]="'vehicles.form.enterModel' | translate"
            class="modern-input"
            fill="outline">
          </ion-input>
          @if (form.get('model')?.invalid && form.get('model')?.touched) {
            <div class="error-message">
              {{ getFieldError('model') }}
            </div>
          }
        </div>

        <!-- Color Field -->
        <div class="field-group">
          <label class="field-label">{{ 'vehicles.form.color' | translate }} *</label>
          <ion-select 
            formControlName="color" 
            [placeholder]="'vehicles.form.selectColor' | translate"
            class="modern-select"
            fill="outline">
            @for (color of colors; track color.id) {
              <ion-select-option [value]="color.id">
                {{ color.name }}
              </ion-select-option>
            }
          </ion-select>
          @if (form.get('color')?.invalid && form.get('color')?.touched) {
            <div class="error-message">
              {{ getFieldError('color') }}
            </div>
          }
        </div>

        <!-- Year Field -->
        <div class="field-group">
          <label class="field-label">{{ 'vehicles.form.year' | translate }}</label>
          <ion-input 
            formControlName="year" 
            type="number" 
            [placeholder]="'vehicles.form.enterYear' | translate"
            class="modern-input"
            fill="outline">
          </ion-input>
          @if (form.get('year')?.invalid && form.get('year')?.touched) {
            <div class="error-message">
              {{ getFieldError('year') }}
            </div>
          }
        </div>

        <!-- Mileage Field -->
        <div class="field-group">
          <label class="field-label">{{ 'vehicles.form.mileage' | translate }}</label>
          <ion-input 
            formControlName="mileage" 
            type="number" 
            [placeholder]="'vehicles.form.enterMileage' | translate"
            class="modern-input"
            fill="outline">
          </ion-input>
          @if (form.get('mileage')?.invalid && form.get('mileage')?.touched) {
            <div class="error-message">
              {{ getFieldError('mileage') }}
            </div>
          }
        </div>

      </div>

    </form>

    <!-- Loading Spinner -->
    @if (loading) {
      <div class="loading-overlay">
        <div class="loading-content">
          <ion-spinner name="crescent"></ion-spinner>
          <p>{{ 'vehicles.actions.save' | translate }}...</p>
        </div>
      </div>
    }
  </div>
   </ion-content>

 <!-- Footer with Action Buttons -->
 <ion-footer class="form-footer">
   <ion-toolbar>
     <div class="footer-buttons">
       <!-- Cancel Button -->
       <ion-button 
         (click)="cancelForm()" 
         fill="solid" 
         color="medium" 
         class="footer-btn cancel-btn">
         <ion-icon name="close" slot="icon-only"></ion-icon>
       </ion-button>

       <!-- Save Button -->
       <ion-button 
         (click)="saveVehicle()" 
         [disabled]="!form.valid || loading"
         fill="solid" 
         color="primary" 
         class="footer-btn save-btn">
         <ion-icon name="checkmark" slot="icon-only"></ion-icon>
       </ion-button>

       <!-- Exit Button -->
       <ion-button 
         (click)="exitScreen()" 
         fill="solid" 
         color="danger" 
         class="footer-btn exit-btn">
         <ion-icon name="home" slot="icon-only"></ion-icon>
       </ion-button>
     </div>
   </ion-toolbar>
 </ion-footer>
