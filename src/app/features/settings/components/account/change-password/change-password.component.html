<ion-header class="uniform-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button menu="main-menu"></ion-menu-button>
      <ion-back-button defaultHref="/settings"></ion-back-button>
    </ion-buttons>
    <ion-title>Cambiar Contraseña</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="uniform-content">
  <div class="uniform-form fade-in">
    
    <!-- Form Header -->
    <div class="form-header">
      <div class="security-icon-container">
        <ion-icon name="shield-checkmark" style="font-size: 3rem; color: var(--primary-color); margin-bottom: var(--spacing-md);"></ion-icon>
      </div>
      <h2>Actualizar Contraseña</h2>
      <p>Mantén tu cuenta segura con una contraseña fuerte</p>
    </div>

    <!-- Main Form -->
    <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
          
          <!-- Current Password Field -->
          <ion-item>
            <ion-label position="stacked">
              <ion-icon name="lock-closed" style="margin-right: var(--spacing-xs); color: var(--primary-color);"></ion-icon>
              Contraseña Actual
            </ion-label>
            <ion-input 
              formControlName="currentPassword"
              [type]="showCurrentPassword ? 'text' : 'password'"
              placeholder="Ingresa tu contraseña actual">
            </ion-input>
            <ion-button 
              fill="clear" 
              slot="end" 
              (click)="showCurrentPassword = !showCurrentPassword">
              <ion-icon [name]="showCurrentPassword ? 'eye-off' : 'eye'"></ion-icon>
            </ion-button>
          </ion-item>
          
          <div class="uniform-alert danger" *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
            <div class="alert-header">
              <ion-icon name="alert-circle"></ion-icon>
              <h4>Error</h4>
            </div>
            <div class="alert-message">La contraseña actual es requerida</div>
          </div>
          
          <!-- New Password Field -->
          <ion-item>
            <ion-label position="stacked">
              <ion-icon name="key" style="margin-right: var(--spacing-xs); color: var(--primary-color);"></ion-icon>
              Nueva Contraseña
            </ion-label>
            <ion-input 
              formControlName="newPassword"
              [type]="showNewPassword ? 'text' : 'password'"
              placeholder="Ingresa tu nueva contraseña">
            </ion-input>
            <ion-button 
              fill="clear" 
              slot="end" 
              (click)="showNewPassword = !showNewPassword">
              <ion-icon [name]="showNewPassword ? 'eye-off' : 'eye'"></ion-icon>
            </ion-button>
          </ion-item>
          
          <div class="uniform-alert danger" *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
            <div class="alert-header">
              <ion-icon name="alert-circle"></ion-icon>
              <h4>Error</h4>
            </div>
            <div class="alert-message">
              <span *ngIf="passwordForm.get('newPassword')?.errors?.['required']">La nueva contraseña es requerida</span>
              <span *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">La contraseña debe tener al menos 8 caracteres</span>
            </div>
          </div>
          
          <!-- Confirm Password Field -->
          <ion-item>
            <ion-label position="stacked">
              <ion-icon name="checkmark-circle" style="margin-right: var(--spacing-xs); color: var(--primary-color);"></ion-icon>
              Confirmar Nueva Contraseña
            </ion-label>
            <ion-input 
              formControlName="confirmPassword"
              [type]="showConfirmPassword ? 'text' : 'password'"
              placeholder="Confirma tu nueva contraseña">
            </ion-input>
            <ion-button 
              fill="clear" 
              slot="end" 
              (click)="showConfirmPassword = !showConfirmPassword">
              <ion-icon [name]="showConfirmPassword ? 'eye-off' : 'eye'"></ion-icon>
            </ion-button>
          </ion-item>
          
          <div class="uniform-alert danger" *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched">
            <div class="alert-header">
              <ion-icon name="alert-circle"></ion-icon>
              <h4>Error</h4>
            </div>
            <div class="alert-message">
              <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">La confirmación de contraseña es requerida</span>
              <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['passwordMismatch']">Las contraseñas no coinciden</span>
            </div>
          </div>

          <!-- Password Requirements -->
          <div class="uniform-alert info">
            <div class="alert-header">
              <ion-icon name="information-circle"></ion-icon>
              <h4>Requisitos de Contraseña</h4>
            </div>
            <div class="alert-message">
              <ul style="margin: 0; padding-left: var(--spacing-lg);">
                <li [style.color]="passwordForm.get('newPassword')?.value?.length >= 8 ? 'var(--success-color)' : 'inherit'">
                  Mínimo 8 caracteres
                </li>
                <li [style.color]="passwordForm.get('newPassword')?.value && passwordForm.get('confirmPassword')?.value && passwordForm.get('newPassword')?.value === passwordForm.get('confirmPassword')?.value ? 'var(--success-color)' : 'inherit'">
                  Las contraseñas coinciden
                </li>
              </ul>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="form-actions">
            <ion-button 
              type="submit" 
              expand="block"
              class="uniform-button primary"
              [disabled]="passwordForm.invalid || isLoading">
              <ion-spinner name="crescent" *ngIf="isLoading"></ion-spinner>
              <ion-icon name="shield-checkmark" slot="start" *ngIf="!isLoading"></ion-icon>
              {{ isLoading ? 'Actualizando...' : 'Actualizar Contraseña' }}
            </ion-button>
          </div>

        </form>
      </div>

      <!-- Security Tips -->
      <div class="uniform-alert info" style="margin-top: var(--spacing-xl);">
        <div class="alert-header">
          <ion-icon name="bulb"></ion-icon>
          <h4>Consejos de Seguridad</h4>
        </div>
        <div class="alert-message">
          <ul style="margin: 0; padding-left: var(--spacing-lg);">
            <li>Usa una combinación de letras, números y símbolos</li>
            <li>Evita información personal como fechas de nacimiento</li>
            <li>No reutilices contraseñas de otras cuentas</li>
            <li>Considera usar un gestor de contraseñas</li>
          </ul>
        </div>
    </div>
  </ion-content>
