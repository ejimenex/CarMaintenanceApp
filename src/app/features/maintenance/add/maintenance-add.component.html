<ion-header class="uniform-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button menu="main-menu"></ion-menu-button>
      <ion-back-button defaultHref="/maintenance"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'maintenance.add.title' | translate }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="saveMaintenance()" [disabled]="!maintenanceForm.valid || loading" fill="solid" color="primary">
        <ion-icon name="checkmark" slot="start"></ion-icon>
        {{ 'maintenance.actions.save' | translate }}
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="modern-form-content">
  <div class="form-container">
    <form [formGroup]="maintenanceForm" (ngSubmit)="saveMaintenance()">
      
      <!-- Header Section -->
      <div class="form-header">
        <ion-icon name="build" class="header-icon"></ion-icon>
        <h2>{{ 'maintenance.add.header.title' | translate }}</h2>
        <p>{{ 'maintenance.add.header.subtitle' | translate }}</p>
      </div>

      <!-- Form Fields -->
      <div class="form-fields">
        
        <!-- Name Field -->
        <div class="field-group">
          <label class="field-label">{{ 'maintenance.form.name.label' | translate }} *</label>
          <ion-input 
            formControlName="name" 
            [placeholder]="'maintenance.form.name.placeholder' | translate"
            class="modern-input"
            fill="outline">
          </ion-input>
          @if (maintenanceForm.get('name')?.invalid && maintenanceForm.get('name')?.touched) {
            <div class="error-message">
              {{ getFieldError('name') }}
            </div>
          }
        </div>

        <!-- Vehicle Selection -->
        <div class="field-group">
          <label class="field-label">{{ 'maintenance.form.vehicle.label' | translate }} *</label>
          <ion-select 
            formControlName="vehicleId" 
            [placeholder]="'maintenance.form.vehicle.placeholder' | translate" 
            class="modern-select"
            fill="outline">
            @for (vehicle of vehicles; track vehicle.value) {
              <ion-select-option [value]="vehicle.value">
                {{ vehicle.label }}
              </ion-select-option>
            }
          </ion-select>
          @if (maintenanceForm.get('vehicleId')?.invalid && maintenanceForm.get('vehicleId')?.touched) {
            <div class="error-message">
              {{ getFieldError('vehicleId') }}
            </div>
          }
        </div>
  <!-- Trade/Workshop Selection -->
  <div class="field-group">
   <label class="field-label">{{ 'maintenance.form.workshop.label' | translate }} *</label>
   <ion-select 
     formControlName="tradeId" 
     [placeholder]="'maintenance.form.workshop.placeholder' | translate" 
     class="modern-select"
     fill="outline">
     @for (workshop of workshops; track workshop.value) {
       <ion-select-option [value]="workshop.value">
         {{ workshop.label }}
       </ion-select-option>
     }
   </ion-select>
  @if (maintenanceForm.get('tradeId')?.invalid && maintenanceForm.get('tradeId')?.touched) {
    <div class="error-message">
      {{ getFieldError('tradeId') }}
    </div>
  }
</div>

        <!-- Process Type Field -->
        <div class="field-group">
          <label class="field-label">{{ 'maintenance.form.processType.label' | translate }} *</label>
          <ion-select 
            formControlName="processType" 
            [placeholder]="'maintenance.form.processType.placeholder' | translate" 
            class="modern-select"
            fill="outline">
            @for (type of processTypes; track type.value) {
              <ion-select-option [value]="type.value">
                {{ ('maintenance.form.processType.options.' + type.value) | translate }}
              </ion-select-option>
            }
          </ion-select>
          @if (maintenanceForm.get('processType')?.invalid && maintenanceForm.get('processType')?.touched) {
            <div class="error-message">
              {{ getFieldError('processType') }}
            </div>
          }
        </div>

        <!-- Start Date Field -->
        <div class="field-group">
          <label class="field-label">{{ 'maintenance.form.startDate.label' | translate }}</label>
          <ion-input 
            formControlName="startDate" 
            type="date"
            class="modern-input"
            fill="outline">
          </ion-input>
          @if (maintenanceForm.get('startDate')?.invalid && maintenanceForm.get('startDate')?.touched) {
            <div class="error-message">
              {{ getFieldError('startDate') }}
            </div>
          }
        </div>

        <!-- End Date Field -->
        <div class="field-group">
          <label class="field-label">{{ 'maintenance.form.endDate.label' | translate }}</label>
          <ion-input 
            formControlName="endDate" 
            type="date"
            class="modern-input"
            fill="outline">
          </ion-input>
          @if (maintenanceForm.get('endDate')?.invalid && maintenanceForm.get('endDate')?.touched) {
            <div class="error-message">
              {{ getFieldError('endDate') }}
            </div>
          }
        </div>

       

          <!-- note Field -->
          <div class="field-group">
            <label class="field-label">{{ 'maintenance.form.note.label' | translate }}</label>
            <ion-textarea 
              formControlName="note" 
              [placeholder]="'maintenance.form.note.placeholder' | translate"
              class="modern-input"
              fill="outline">
            </ion-textarea >
          @if (maintenanceForm.get('note')?.invalid && maintenanceForm.get('note')?.touched) {
            <div class="error-message">
              {{ getFieldError('note') }}
            </div>
          }
        </div>

       
      </div>

    </form>

    <!-- Loading Spinner -->
    @if (loading) {
      <div class="loading-overlay">
        <div class="loading-content">
          <ion-spinner name="crescent"></ion-spinner>
          <p>{{ 'maintenance.add.saving' | translate }}</p>
        </div>
      </div>
    }
  </div>
</ion-content>

<!-- Footer with Action Buttons -->
<ion-footer class="form-footer">
  <ion-toolbar>
    <div class="footer-buttons">
      <!-- Cancel Button -->
      <ion-button 
        (click)="cancelForm()" 
        fill="solid" 
        color="medium" 
        class="footer-btn cancel-btn">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>

      <!-- Save Button -->
      <ion-button 
        (click)="saveMaintenance()" 
        [disabled]="!maintenanceForm.valid || loading"
        fill="solid" 
        color="primary" 
        class="footer-btn save-btn">
        <ion-icon name="checkmark" slot="icon-only"></ion-icon>
      </ion-button>

      <!-- Exit Button -->
      <ion-button 
        (click)="exitScreen()" 
        fill="solid" 
        color="danger" 
        class="footer-btn exit-btn">
        <ion-icon name="home" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>