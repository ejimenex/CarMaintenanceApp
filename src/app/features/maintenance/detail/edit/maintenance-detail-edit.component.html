<ion-header class="uniform-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button (click)="onCancel()"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'maintenance_detail_edit_title' | translate }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="onSubmit()" [disabled]="!maintenanceDetailForm.valid || loading" fill="solid" color="primary">
        <ion-icon name="checkmark" slot="start"></ion-icon>
        {{ 'common_save' | translate }}
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="modern-form-content">
  <div class="form-container">
    <form [formGroup]="maintenanceDetailForm" (ngSubmit)="onSubmit()">
      
      <!-- Header Section -->
      <div class="form-header">
        <ion-icon name="construct" class="header-icon"></ion-icon>
        <h2>{{ 'maintenance_detail_edit_title' | translate }}</h2>
        <p>{{ 'maintenance_detail_edit_form_description' | translate }}</p>
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="loading" class="loading-container">
        <ion-spinner name="crescent"></ion-spinner>
        <p>{{ 'common_loading' | translate }}</p>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage && !loading" class="error-container">
        <ion-icon name="alert-circle" color="danger"></ion-icon>
        <p>{{ errorMessage }}</p>
        <ion-button (click)="loadMaintenanceDetail()" fill="outline" color="primary">
          {{ 'common_retry' | translate }}
        </ion-button>
      </div>

      <!-- Form Fields -->
      <div class="form-fields" *ngIf="!loading && maintenanceDetail">
        
        <!-- Name Field -->
        <div class="field-group">
          <label class="field-label">{{ 'maintenance_detail_edit_form_name' | translate }} *</label>
          <ion-input 
            formControlName="name" 
            [placeholder]="'maintenance_detail_edit_form_name_placeholder' | translate"
            class="modern-input"
            fill="outline">
          </ion-input>
          @if (isFieldInvalid('name')) {
            <div class="error-message">
              {{ getFieldError('name') }}
            </div>
          }
        </div>

        <!-- Description Field -->
        <div class="field-group">
          <label class="field-label">{{ 'maintenance_detail_edit_form_description' | translate }}</label>
          <ion-textarea 
            formControlName="description" 
            [placeholder]="'maintenance_detail_edit_form_description_placeholder' | translate"
            class="modern-textarea"
            fill="outline"
            rows="3">
          </ion-textarea>
        </div>

        <!-- Diagnosis Field -->
        <div class="field-group">
          <label class="field-label">{{ 'maintenance_detail_edit_form_diagnosis' | translate }} *</label>
          <ion-textarea 
            formControlName="diagnosis" 
            [placeholder]="'maintenance_detail_edit_form_diagnosis_placeholder' | translate"
            class="modern-textarea"
            fill="outline"
            rows="3">
          </ion-textarea>
          @if (isFieldInvalid('diagnosis')) {
            <div class="error-message">
              {{ getFieldError('diagnosis') }}
            </div>
          }
        </div>

        <!-- Mileage and Cost Row -->
        <div class="row">
          <div class="col-6">
            <div class="field-group">
              <label class="field-label">{{ 'maintenance_detail_edit_form_mileage' | translate }} *</label>
              <ion-input 
                formControlName="mileage" 
                type="number"
                [placeholder]="'maintenance_detail_edit_form_mileage_placeholder' | translate"
                class="modern-input"
                fill="outline">
              </ion-input>
              @if (isFieldInvalid('mileage')) {
                <div class="error-message">
                  {{ getFieldError('mileage') }}
                </div>
              }
            </div>
          </div>
          <div class="col-6">
            <div class="field-group">
              <label class="field-label">{{ 'maintenance_detail_edit_form_cost' | translate }} *</label>
              <ion-input 
                formControlName="cost" 
                type="number"
                step="0.01"
                [placeholder]="'maintenance_detail_edit_form_cost_placeholder' | translate"
                class="modern-input"
                fill="outline">
              </ion-input>
              @if (isFieldInvalid('cost')) {
                <div class="error-message">
                  {{ getFieldError('cost') }}
                </div>
              }
            </div>
          </div>
        </div>

        <!-- Technician Field -->
        <div class="field-group">
          <label class="field-label">{{ 'maintenance_detail_edit_form_technician' | translate }}</label>
          <ion-input 
            formControlName="Technician" 
            [placeholder]="'maintenance_detail_edit_form_technician_placeholder' | translate"
            class="modern-input"
            fill="outline">
          </ion-input>
        </div>

        <!-- Maintenance Type Field -->
        <div class="field-group">
          <label class="field-label">{{ 'maintenance_detail_edit_form_maintenanceType' | translate }} *</label>
          <ion-select 
            formControlName="maintenanceTypeId"
            [placeholder]="'maintenance_detail_edit_form_maintenanceType_placeholder' | translate"
            class="modern-select"
            fill="outline">
            @for (type of maintenanceTypes; track type.code) {
              <ion-select-option [value]="type.code">
                {{ type.name }}
              </ion-select-option>
            }
          </ion-select>
          @if (isFieldInvalid('maintenanceTypeId')) {
            <div class="error-message">
              {{ getFieldError('maintenanceTypeId') }}
            </div>
          }
        </div>

        <!-- Next Maintenance Date Field -->
        <div class="field-group">
          <label class="field-label">{{ 'maintenance_detail_edit_form_nextMaintenanceDate' | translate }}</label>
          <ion-input 
            formControlName="nextMaintenanceDate" 
            type="date"
            class="modern-input"
            fill="outline">
          </ion-input>
        </div>

      </div>

    </form>

    <!-- Loading Spinner -->
    @if (loading) {
      <div class="loading-overlay">
        <div class="loading-content">
          <ion-spinner name="crescent"></ion-spinner>
          <p>{{ 'common_loading' | translate }}</p>
        </div>
      </div>
    }
  </div>
</ion-content>

<!-- âœ… FOOTER CON APP-FOOTER -->
<app-footer
  [showSaveButton]="true"
  [saveButtonText]="'common.update'"
  [saveButtonDisabled]="maintenanceDetailForm.invalid"
  [saveButtonLoading]="loading"
  (onSave)="onSubmit()"
  (onBack)="onCancel()">
</app-footer>
