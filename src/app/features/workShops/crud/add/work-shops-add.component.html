<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/workshops"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'workshops_add_title' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="form-container">
    <form [formGroup]="workshopForm" (ngSubmit)="saveWorkshop()">
      
      <!-- ========== HEADER SECCIÓN ========== -->
      <div class="form-header">
        <ion-icon name="construct-outline" class="header-icon"></ion-icon>
        <h2>{{ 'trades' | translate }}</h2>
        <p>{{ 'workshops_add_header_subtitle' | translate }}</p>
      </div>

      <!-- ========== INFORMACIÓN BÁSICA ========== -->
      <div class="form-section">
        <div class="section-title">
          <ion-icon name="information-circle-outline"></ion-icon>
          <span>Información del Taller</span>
        </div>

        <div class="form-fields">
          
          <!-- Nombre del Taller -->
          <div class="field-group" [class.has-error]="workshopForm.get('name')?.invalid && workshopForm.get('name')?.touched">
            <label class="field-label">
              <ion-icon name="construct-outline"></ion-icon>
              {{ 'workshops_form_name_label' | translate }} *
            </label>
            <ion-input
              formControlName="name"
              [placeholder]="'workshops_form_name_placeholder' | translate">
            </ion-input>
            @if (workshopForm.get('name')?.invalid && workshopForm.get('name')?.touched) {
              <div class="error-message">
                <ion-icon name="alert-circle-outline"></ion-icon>
                {{ getFieldError('name') }}
              </div>
            }
          </div>

          <!-- Grid de 2 columnas para Workshop Type y Trade Type -->
          <div class="form-row">
            
            <!-- Tipo de Taller -->
            <div class="field-group" [class.has-error]="workshopForm.get('worksShopTypeId')?.invalid && workshopForm.get('worksShopTypeId')?.touched">
              <label class="field-label">
                <ion-icon name="business-outline"></ion-icon>
                {{ 'workshops_form_workShopType_label' | translate }} *
              </label>
              <ion-select
                formControlName="worksShopTypeId"
                [placeholder]="'workshops_form_workShopType_placeholder' | translate"
                interface="popover">
                @for (type of workShopTypes; track type.id) {
                  <ion-select-option [value]="type.id">{{ type.name | translate }}</ion-select-option>
                }
              </ion-select>
              @if (workshopForm.get('worksShopTypeId')?.invalid && workshopForm.get('worksShopTypeId')?.touched) {
                <div class="error-message">
                  <ion-icon name="alert-circle-outline"></ion-icon>
                  {{ getFieldError('worksShopTypeId') }}
                </div>
              }
            </div>

            <!-- Tipo de Comercio -->
            <div class="field-group" [class.has-error]="workshopForm.get('tradeTypeId')?.invalid && workshopForm.get('tradeTypeId')?.touched">
              <label class="field-label">
                <ion-icon name="storefront-outline"></ion-icon>
                {{ 'workshops_form_tradeType_label' | translate }} *
              </label>
              <ion-select
                formControlName="tradeTypeId"
                [placeholder]="'workshops_form_tradeType_placeholder' | translate"
                interface="popover">
                @for (type of tradeTypes; track type.id) {
                  <ion-select-option [value]="type.id">{{ type.name | translate }}</ion-select-option>
                }
              </ion-select>
              @if (workshopForm.get('tradeTypeId')?.invalid && workshopForm.get('tradeTypeId')?.touched) {
                <div class="error-message">
                  <ion-icon name="alert-circle-outline"></ion-icon>
                  {{ getFieldError('tradeTypeId') }}
                </div>
              }
            </div>
          </div>

        </div>
      </div>

      <!-- Separador -->
      <hr class="form-divider">

      <!-- ========== INFORMACIÓN DE CONTACTO ========== -->
      <div class="form-section">
        <div class="section-title">
          <ion-icon name="call-outline"></ion-icon>
          <span>Información de Contacto</span>
        </div>

        <div class="form-fields">
          
          <!-- Dirección -->
          <div class="field-group" [class.has-error]="workshopForm.get('address')?.invalid && workshopForm.get('address')?.touched">
            <label class="field-label">
              <ion-icon name="location-outline"></ion-icon>
              {{ 'workshops_form_address_label' | translate }} *
            </label>
            <ion-input
              formControlName="address"
              [placeholder]="'workshops_form_address_placeholder' | translate">
            </ion-input>
            @if (workshopForm.get('address')?.invalid && workshopForm.get('address')?.touched) {
              <div class="error-message">
                <ion-icon name="alert-circle-outline"></ion-icon>
                {{ getFieldError('address') }}
              </div>
            }
          </div>

          <!-- Teléfono -->
          <div class="field-group" [class.has-error]="workshopForm.get('phone')?.invalid && workshopForm.get('phone')?.touched">
            <label class="field-label">
              <ion-icon name="call-outline"></ion-icon>
              {{ 'workshops_form_phone_label' | translate }} *
            </label>
            <ion-input
              formControlName="phone"
              type="tel"
              [placeholder]="'workshops_form_phone_placeholder' | translate">
            </ion-input>
            <div class="field-hint">
              Ejemplo: +34 123 456 789
            </div>
            @if (workshopForm.get('phone')?.invalid && workshopForm.get('phone')?.touched) {
              <div class="error-message">
                <ion-icon name="alert-circle-outline"></ion-icon>
                {{ getFieldError('phone') }}
              </div>
            }
          </div>

        </div>
      </div>

    </form>

    <!-- Loading Overlay -->
    @if (loading) {
      <div class="loading-overlay">
        <div class="loading-content">
          <ion-spinner name="crescent"></ion-spinner>
          <p>{{ 'workshops_add_saving' | translate }}</p>
        </div>
      </div>
    }
  </div>
</ion-content>

<!-- ✅ FOOTER CON APP-FOOTER -->
<app-footer
  [showSaveButton]="true"
  [saveButtonText]="'common.save'"
  [saveButtonDisabled]="workshopForm.invalid"
  [saveButtonLoading]="loading"
  [customBackRoute]="'/workshops'"
  (onSave)="saveWorkshop()"
  (onBack)="cancelForm()">
</app-footer>
